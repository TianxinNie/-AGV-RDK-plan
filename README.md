# Flexiv机器人内存条处理自动化系统

基于Flexiv RDK的工业内存条处理自动化解决方案，集成AGV移动功能，实现完整的自动化作业流程。

## 🏗️ 项目结构

```
robot_project/
├── main.py                 # 主程序入口
├── AGV.py                  # AGV控制模块（支持连接监测和自动重连）
├── core/                   # 核心模块
│   ├── __init__.py
│   ├── rdk_init.py        # RDK初始化
│   └── work_handler.py    # 通用工作步骤处理器
├── plans/                 # 机器人计划模块
│   ├── __init__.py
│   ├── change_tool.py     # 换刀具功能
│   ├── pick_mestick.py    # 取内存条功能
│   └── Put_mestick.py     # 放内存条功能
└── utils/                 # 工具模块
    ├── __init__.py
    └── logger.py          # 日志工具
```

## 📦 依赖要求

```bash
# 机器人控制
pip install flexivrdk spdlog

# AGV通信
pip install pymodbus
```

## 🚀 使用方法

### 基本使用（推荐）
```bash
# 简单启动 - AGV功能默认启用
python3 main.py <机器人序列号>

# 示例
python3 main.py FR3_001
```

### 高级配置
```bash
# 自定义AGV设置
python3 main.py <机器人序列号> --agv-ip 192.168.2.100 --work-station 3

# 禁用AGV功能（仅机器人操作）
python3 main.py <机器人序列号> --disable-agv

# 自定义日志名称
python3 main.py <机器人序列号> --log-name MyRobot
```

### 完整参数说明
```bash
python3 main.py <机器人序列号> [选项]

必需参数:
  机器人序列号        Flexiv机器人的序列号

可选参数:
  --work-num N       工作编号 (默认: 1)
  --log-name NAME    日志记录器名称 (默认: RobotLogger)
  --agv-ip IP        AGV的IP地址 (默认: 192.168.2.112)
  --agv-port PORT    AGV的Modbus端口 (默认: 502)
  --work-station N   工作站点ID (默认: 5)
  --disable-agv      禁用AGV移动功能
```

## ⚡ 工作流程

1. **程序启动** → 初始化机器人和AGV控制器
2. **机器人换工具** → 切换到指定工具
3. **AGV自动移动** → 移动到指定工作站点
4. **机器人取内存条** → 完成取料操作
5. **状态监控** → 全程日志记录和异常处理

## 🎯 功能特性

### 机器人控制
- ✅ **模块化架构**: 清晰的代码组织结构
- ✅ **错误处理**: 完善的异常捕获和重试机制
- ✅ **状态管理**: 基于全局变量的状态通信
- ✅ **参数化配置**: 灵活的命令行参数

### AGV集成
- ✅ **连接监测**: 实时心跳检测和健康状态监控
- ✅ **自动重连**: 网络中断时自动恢复连接
- ✅ **故障转移**: AGV故障不影响机器人操作继续
- ✅ **参数验证**: 速度和位置参数安全检查

### 系统可靠性
- ✅ **详细日志**: 完整的操作记录和错误诊断
- ✅ **异常处理**: 优雅的错误恢复机制
- ✅ **生产就绪**: 适合工业环境的稳定性设计

## 🔧 配置说明

### AGV网络配置
确保AGV设备网络配置正确：
- IP地址: `192.168.2.112` (可通过参数修改)
- Modbus TCP端口: `502`
- 网络连通性良好

### 机器人配置
确保Flexiv机器人已正确配置：
- 机器人序列号正确
- RDK环境已安装
- 机器人计划文件已加载

## 🚨 故障排除

### 常见问题

1. **AGV连接失败**
   ```
   [ERROR] [AGV] 连接失败 - IP: 192.168.2.112:502
   ```
   - 检查AGV设备是否开机
   - 确认网络连接正常
   - 验证IP地址和端口配置

2. **机器人连接失败**
   ```
   [ERROR] 程序执行过程中发生异常
   ```
   - 检查机器人序列号是否正确
   - 确认RDK环境已安装
   - 验证机器人状态正常

3. **AGV移动失败**
   ```
   [WARNING] AGV移动失败，但程序将继续执行
   ```
   - 程序会继续机器人操作
   - 检查AGV定位状态
   - 确认工作站点ID有效

## 🔍 日志监控

程序运行时会输出详细日志：
```
[INFO] 程序启动
[INFO] 机器人序列号: FR3_001
[INFO] AGV控制已启用 - IP: 192.168.2.112:502, 工作站点: 5
[INFO] [AGV] 成功连接到AGV - 192.168.2.112:502
[INFO] 开始执行换工具流程...
[INFO] [AGV] AGV开始移动到工作站点 5...
[INFO] [AGV] ✅ 机器人已到达目标站点
[INFO] 开始执行取内存条流程...
[INFO] 所有机器人操作成功完成！
```

## 📈 开发说明

项目采用计划驱动的架构模式：
- **机器人操作**: 通过预定义的"计划"执行复杂动作
- **Python控制**: 负责流程控制、状态监控和AGV协调
- **模块化设计**: 便于扩展和维护
- **工业级可靠性**: 适合生产环境部署